name: Dependency Updates

on:
   schedule:
      - cron: '0 0 * * 1' # Every Monday at midnight
   workflow_dispatch: # Manual trigger

jobs:
   update-dependencies:
      name: Update Dependencies
      runs-on: ubuntu-latest

      steps:
         - uses: actions/checkout@v3

         - name: Set up Node.js
           uses: actions/setup-node@v3
           with:
              node-version: '22'
              cache: 'npm'

         - name: Check for updates
           id: update
           run: |
              npm outdated --json > outdated.json || true
              if [ -s outdated.json ]; then
                echo "updates_available=true" >> $GITHUB_OUTPUT
              else
                echo "updates_available=false" >> $GITHUB_OUTPUT
              fi

         - name: Create Pull Request
           if: steps.update.outputs.updates_available == 'true'
           uses: peter-evans/create-pull-request@v5
           with:
              token: ${{ secrets.PERSONAL_GITHUB_TOKEN }}
              commit-message: 'chore: update dependencies'
              title: 'chore: update dependencies'
              body: |
                 This PR updates outdated dependencies.

                 Auto-generated by the Dependency Updates workflow.
              branch: dependency-updates
              base: main

         - name: Clean up
           run: rm -f outdated.json
